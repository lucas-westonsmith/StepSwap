<div class="container">
  <!-- Shoe Brand -->
  <h1 class="shoe-brand"><%= @shoe.brand %></h1>

  <div class="main-content">
    <!-- Large Image Section -->
<div class="image-section">
  <% if @shoe.photo.attached? %>
    <%= cl_image_tag @shoe.photo.key,
                     transformation: { width: 300, height: 300, crop: :fill },
                     title: @shoe.title %>
  <% else %>
    <img src="default-image.jpg" alt="<%=@shoe.title%>" title="<%=@shoe.title%>">
  <% end %>
</div>


    <!-- Right-Side Details and Form Section -->
    <div class="right-section">
      <!-- Details Section -->
      <div class="details-section">
        <p><strong>Size:</strong> <%= @shoe.size %></p>
        <p><strong>Condition:</strong> <%= @shoe.condition.capitalize %></p>
        <p><strong>Price per Day:</strong> $<%= @shoe.price_per_day %></p>
        <p><strong>Availability:</strong> <%= @shoe.availability ? 'Available' : 'Not Available' %></p>
      </div>


      <div class="form-section">
        <% if user_signed_in? && @shoe.availability %>
          <h2>Check the price</h2>
          <%= form_with model: @shoe, url: new_shoe_booking_path(@shoe), method: :get, local: true do |f| %>
            <div class="form-group">
              <%= f.label :start_date, "Start Date" %>
              <%= f.date_field :start_date, required: true, id: 'start_date' %>
            </div>
            <div class="form-group">
              <%= f.label :end_date, "End Date" %>
              <%= f.date_field :end_date, required: true, id: 'end_date' %>
            </div>
            <div class="form-group">
              <label>Total: $<span id="total_price"><%= @total %></span></label>
            </div>
            <div class="form-actions">
            <%= link_to 'Book Now', new_shoe_booking_path(@shoe, start_date: params[:start_date], end_date: params[:end_date]), class: 'btn btn-success', id: 'book-now-link' %>
            </div>
          <% end %>
        <% else %>
          <p class="warning">Sorry, this shoe is not available for booking at the moment.</p>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Description Section -->
  <div class="description-section">
    <h2>Description</h2>
    <p><%= @shoe.description %></p>
  </div>

  <!-- Reviews Section -->
  <div class="reviews-section">
    <h2>Customer Reviews</h2>
    <p>No reviews yet</p>
  </div>
</div>

<!-- Add JavaScript for Total Price Calculation -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Get elements
    const startDateField = document.getElementById('start_date');
    const endDateField = document.getElementById('end_date');
    const totalPriceLabel = document.getElementById('total_price');
    const pricePerDay = <%= @shoe.price_per_day %>; // Pass price per day from Rails

    // Function to update the total price
    function updateTotalPrice() {
      const startDate = new Date(startDateField.value);
      const endDate = new Date(endDateField.value);

      // Ensure both dates are selected
      if (startDate && endDate && endDate >= startDate) {
        const timeDifference = endDate - startDate;
        const days = timeDifference / (1000 * 3600 * 24); // Convert milliseconds to days
        const totalPrice = days * pricePerDay;
        totalPriceLabel.textContent = totalPrice.toFixed(2);
      }
    }

    // Add event listeners to date fields
    startDateField.addEventListener('change', updateTotalPrice);
    endDateField.addEventListener('change', updateTotalPrice);
  });
</script>
