<div class="container">
  <!-- Shoe Brand -->
  <h1 class="shoe-brand"><%= @shoe.title %></h1>

  <div class="main-content">
    <!-- Large Image Section -->
<div class="image-section">
  <% if @shoe.photo.attached? %>
    <%= cl_image_tag @shoe.photo.key,
                     transformation: { width: 300, height: 300, crop: :fill },
                     title: @shoe.title %>
  <% else %>
    <img src="<%= asset_path('default-image.jpg') %>" alt="<%= @shoe.title %>" title="<%= @shoe.title %>">
  <% end %>
</div>


    <!-- Right-Side Details and Form Section -->
    <div class="right-section">
      <!-- Details Section -->
      <div class="details-section">
        <p><strong>Brand:</strong><%= @shoe.brand %></p>
        <p><strong>Size:</strong> <%= @shoe.size %></p>
        <p><strong>Condition:</strong> <%= @shoe.condition.capitalize %></p>
        <p><strong>Price per Day:</strong> $<%= @shoe.price_per_day %></p>
        <p><strong>Availability:</strong> <%= @shoe.availability ? 'Available' : 'Not Available' %></p>
      </div>


      <div class="form-section">
  <% if @shoe.availability %>
    <h2 class="form-title">Book It and Rock It!</h2>
    <%= form_with model: [@shoe, @shoe.bookings.build], url: shoe_bookings_path(@shoe), method: :post, local: true, class: 'booking-form' do |f| %>
      <!-- Start Date -->
      <div class="form-group">
        <%= f.label :start_date, "Start Date" %>
        <%= f.date_field :start_date, required: true, id: 'start_date', class: 'form-control' %>
      </div>

      <!-- End Date -->
      <div class="form-group">
        <%= f.label :end_date, "End Date" %>
        <%= f.date_field :end_date, required: true, id: 'end_date', class: 'form-control' %>
      </div>

      <!-- Message (Optional) -->
      <div class="form-group">
        <%= f.label :message, "Message (Optional)" %>
        <%= f.text_area :message, rows: 3, class: 'form-control' %>
      </div>

      <!-- Payment Method -->
      <div class="form-group">
  <%= f.label :payment_method, "Payment Method" %>
  <%= f.select :payment_method, options_for_select([['Credit Card', 'credit_card'], ['PayPal', 'paypal'], ['Bank Transfer', 'bank_transfer']]), class: 'form-control payment-select' %>
</div>


      <!-- Total Price Section -->
      <div class="form-group">
        <label>Total: $<span id="total_price">0.00</span></label>
      </div>

      <!-- Submit Button -->
      <div class="form-actions">
        <%= f.submit 'Book Now', class: 'btn btn-success' %>
      </div>
    <% end %>
  <% else %>
    <p class="warning">Sorry, this shoe is not available for booking at the moment.</p>
  <% end %>
</div>

    </div>
  </div>

  <!-- Description Section -->
  <div class="description-section">
    <h2>Description</h2>
    <p><%= @shoe.description %></p>
  </div>

  <!-- Reviews Section -->
  <div class="reviews-section">
    <h2>Customer Reviews</h2>
    <p>No reviews yet</p>
  </div>
</div>

<!-- Add JavaScript for Total Price Calculation -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Get elements
    const startDateField = document.getElementById('start_date');
    const endDateField = document.getElementById('end_date');
    const totalPriceLabel = document.getElementById('total_price');
    const pricePerDay = <%= @shoe.price_per_day %>; // Pass price per day from Rails

    // Function to update the total price
    function updateTotalPrice() {
      const startDate = new Date(startDateField.value);
      const endDate = new Date(endDateField.value);

      // Ensure both dates are selected
      if (startDate && endDate && endDate >= startDate) {
        const timeDifference = endDate - startDate;
        const days = timeDifference / (1000 * 3600 * 24); // Convert milliseconds to days
        const totalPrice = days * pricePerDay;
        totalPriceLabel.textContent = totalPrice.toFixed(2);
      }
    }

    // Add event listeners to date fields
    startDateField.addEventListener('change', updateTotalPrice);
    endDateField.addEventListener('change', updateTotalPrice);
  });
</script>
